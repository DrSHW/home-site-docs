---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

 ## 7.2 文件的逻辑结构

所谓“逻辑结构”，就是指在**用户**看来，文件内部的数据应该是如何组织起来的。而“物理结构”指的是在**操作系统**看来，文件的数据是如何存放在外存中的。（类似数据结构中的“链表”和“顺序表”）

<img src="https://images.drshw.tech/images/notes/image-20221103173754745.png" alt="image-20221103173754745" style="zoom:50%;" />

对于[无结构文件](https://docs.drshw.tech/os/7/1/#712-%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%BB%84%E7%BB%87%E6%96%B9%E5%BC%8F)，其文件内部的数据其实就是一系列字符流，没有明显的结构特性。因此也不用探讨无结构文件的“逻辑结构”问题。

本节中探讨**有结构文件**的逻辑结构，根据有结构文件中的各条记录在逻辑上如何组织，可以分为三类：

<img src="https://images.drshw.tech/images/notes/image-20221103154445788.png" alt="image-20221103154445788" style="zoom: 50%;" />

### 7.2.1 顺序文件

**顺序文件**：文件中的记录一个接一个地顺序排列（逻辑上），记录可以是定长的或可变长的。各条记录在物理上可以**顺序存储**或**链式存储**。

<img src="https://images.drshw.tech/images/notes/image-20221103161732269.png" alt="image-20221103161732269" style="zoom:50%;" /><img src="https://images.drshw.tech/images/notes/image-20221103161742181.png" alt="image-20221103161742181" style="zoom:50%;" />

根据记录是否根据关键字的顺序排列，顺序文件又可分为**串结构**和**顺序结构**：

<img src="https://images.drshw.tech/images/notes/image-20221103161914471.png" alt="image-20221103161914471" style="zoom:50%;" />

顺序文件是否能够实现**随机存取**（根据下标取得元素）/**快速检索**（找到某关键字对应记录的存放位置）：

<img src="https://images.drshw.tech/images/notes/image-20221103162134615.png" alt="image-20221103162134615" style="zoom:50%;" />

结论：定长记录的顺序文件，若物理上采用顺序存储，则可实现随机存取；若能再保证记录的顺序结构，则可实现快速检索。

注：一般来说，考试题目中所说的“顺序文件”，指的是**物理上顺序存储的顺序文件**。之后的讲解中提到的顺序文件也是如此。

可见，顺序文件的**缺点**是**增加/删除一条记录比较困难**（如果是串结构则相对简单）。

### 7.2.2 索引文件

对于可变长记录文件，要找到第`i`条记录，必须先顺序查找前`i - 1`条记录，但是很多应用场景中又必须使用可变长记录，此时就需要引入**索引表**：

<img src="https://images.drshw.tech/images/notes/image-20221103165654869.png" alt="image-20221103165654869" style="zoom:50%;" />

**索引表**本身是**定长记录的顺序文件**，因此可以快速找到第`i`条记录对应的索引项。可将关键字作为索引号内容，若按关键字顺序排列，则还可以按照关键字折半查找。

每当要增加/删除一条记录时，需要对索引表进行修改。由于索引文件有很快的检索速度，因此**主要用于对信息处理的及时性要求比较高的场合**。

另外，**可以用不同的数据项建立多个索引表**。如：学生信息表中，可用关键字“学号”建立一张索引表。也可用“姓名”建立一张索引表。这样就可以根据“姓名”快速地检索文件了。

索引文件的缺点：每条记录对应一个索引表项，因此索引表可能会很大，降低了存储空间的利用率。

### 7.2.3 索引顺序文件

为了解决索引文件的缺点，引入了索引顺序文件。它是索引文件与顺序文件思想的结合。索引顺序文件中，同样会为文件建立一张索引表，但不同的是，并不是每条记录对应一个索引表项，而是**一组记录对应一个索引表项**，示例：

<img src="https://images.drshw.tech/images/notes/image-20221103171036179.png" alt="image-20221103171036179" style="zoom:50%;" />

在本例中，学生记录按照学生姓名的开头字母进行**分组**。每个分组就是一个顺序文件，分组内的记录不需要按关键字排序。

> 检索效率分析：
>
> + 若一个**顺序文件**有10000条记录，则根据关键字检索文件，只能从头开始查找（这里指的并不是定长记录、顺序结构 的顺序文件），**平均须查找5000条记录**；
> + 若采用**索引顺序文件**结构，可把10000条记录分为`√10000 = 100`组，每组100条记录。则需要先顺序查找索引表找到分组（共100个分组，因此索引表长度为100，平均需要查50次），找到分组后，再在分组中顺序查找记录（每组100条记录，因此平均需要查找50次）。可见，采用索引顺序文件结构后，**平均查找次数减少为`50 + 50 = 100`次**。

因此，顺序索引文件方式也具有比较好的检索性能。

同理，若文件具有`10^6`条记录，则可分为1000个分组，每个分组1000条记录。根据关键字检索一个记录平均需要查找`500 + 500 = 1000`次，这个查找次数依然很多，需要引入多级索引顺序文件。

### 7.2.4 多级索引顺序文件

为进一步提高检索效率，可以为顺序文件建立多级索引表。例如，对于一个含`10^6`条记录的文件，可先为该文件建立一张低级索引表，每100条记录为一组，故低级索引表中共有10000个表项（即10000条定长记录），再把这10000条定长记录分组，每组100个，为其建立顶级索引表，故索引表中共有100个表项，示例：

<img src="https://images.drshw.tech/images/notes/image-20221103173359923.png" alt="image-20221103173359923" style="zoom:50%;" />

此时，检索一个记录平均仅需查找`50 + 50 + 50 = 150`次。
