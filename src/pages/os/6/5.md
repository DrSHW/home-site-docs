---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

## 6.5 假脱机技术

<img src="https://images.drshw.tech/images/notes/image-20221112235835984.png" alt="image-20221112235835984" style="zoom:50%;" />

### 6.5.1 脱机技术的概念

脱机技术/输出技术在[计算机批处理阶段](https://docs.drshw.tech/os/1/3/#132-%E6%89%B9%E5%A4%84%E7%90%86%E9%98%B6%E6%AE%B5)（手工操作阶段之后）引入：

<img src="https://images.drshw.tech/images/notes/image-20221113001056759.png" alt="image-20221113001056759" style="zoom:50%;" />

> 刚引入时，脱机技术使用磁带完成。在外围控制机的控制下，慢速设备的数据先被输入到更快速的磁带上。之后主机可以从快速的磁带上读入数据，从而缓解了速度矛盾。

所谓“脱机”，就是脱离主机的控制进行的输入/输出操作。

### 6.5.3 假脱机技术的概念

**假脱机技术**又称**`SPOOLing`技术**，是用软件的方式模拟脱机技术。

SPOOLing 系统的组成如下：

<img src="https://images.drshw.tech/images/notes/image-20221113001554486.png" alt="image-20221113001554486" style="zoom:50%;" />

磁盘上会开辟两个存储区域“输入井”与“输出井”：

+ “输入井”模拟脱机技术输入时的磁带，用于收容I/O设备输入的数据；
+ “输出井”模拟脱机技术输出时的磁带，用于收容I/O设备输出的数据；

外围控制机由“输入进程”和“输出进程”实现：

+ “输入进程”模拟脱机输入时的外围控制机；
+ “输出进程”模拟脱机输出时的外围控制机；
+ 这两种进程需要并发执行，即要实现SPOOLing技术，**必须要有多道程序技术的支持**。

在内存中，会开辟“输入缓冲区”和“输出缓冲区”：

+ 在输入进程的控制下，“输入缓冲区”用于暂存从输入设备输入的数据，之后再转存到输入井中；
+ 在输出进程的控制下，“输出缓冲区”用于暂存从输入井中送来的数据，之后再传送到输出设备上；

### 6.5.3 案例——共享打印机原理分析

在[I/O设备的概念和分类](https://docs.drshw.tech/os/6/1/#612-io%E8%AE%BE%E5%A4%87%E7%9A%84%E5%88%86%E7%B1%BB)一节中，提到过独占式设备和共享设备。

打印机是一种“独占式设备”，但是可以使用SPOOLing技术将其改造成“共享设备”：

<img src="https://images.drshw.tech/images/notes/image-20221113003641358.png" alt="image-20221113003641358" style="zoom: 50%;" />

当多个用户进程提出输出打印的请求时，系统会答应它们的请求，但是并不是真正把打印机分配给他们，而是由假脱机管理进程做两件事：

1. 在磁盘输出井中为进程申请一个空闲缓冲区（也就是说，这个缓冲区是磁盘上的），并将要打印的数据送入其中；
2. 为用户进程申请一张空白的打印请求表，并将用户的打印请求填入表中（其实就是用来说明用户的打印数据存放位置等信息的），再将该表挂到假脱机文件队列上。

当打印机空闲时，输出进程会从文件队列的队头取出一张打印请求表，并根据表中的要求将要打印的数据从输出井传送到输出缓冲区，再输出到打印机进行打印。用这种方式可依次处理完全部的打印任务。

虽然系统中只有一台打印机，但每个进程提出打印请求时，系统都会为在输出井中为其分配一个存储区（相当于分配了一个逻辑设备），使每个用户进程都觉得自己在独占一台打印机，从而实现对打印机的共享。

由此，SPOOLing技术实现了将一台物理设备虚拟成逻辑上的多台设备，**可将独占式设备改造成共享设备**。

