---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

## 6.2 I/O控制器

<img src="https://images.drshw.tech/images/notes/image-20221112155619815.png" alt="image-20221112155619815" style="zoom: 50%;" />

### 6.2.1 I/O设备的部件

I/O设备部件可分为的**机械部件**和**电子部件**：

+ **机械部件**主要用于执行具体的I/O操作，如鼠标/键盘上的按钮；显示器的LED屏；移动硬盘的磁臂、磁盘盘面；
+ **电子部件**通常是一块插入主板扩充槽的印刷电路板。

CPU无法直接控制I/O设备的机械部件，因此I/O设备还要有一个电子部件作为CPU和I/O设备机械部件之间的“中介”，用于实现CPU对设备 的控制。

这个电子部件就是**I/O控制器**，又称**设备管理器**。CPU可控制I/O控制器，又由I/O控制器来控制设备的机械部件。

### 6.2.2 I/O控制器的功能

I/O控制器有四大功能：

+ **接收和识别CPU发出的命令**：

  如CPU发来的`read/write`命令，I/O控制器中会有相应的**控制寄存器**来存放命令和参数；

+ **向CPU报告设备的状态**：

  I/O控制器中会有相应的**状态寄存器**，用于记录I/O设备的当前状态。如：1表示空闲，0表示忙碌；

+ **数据交换**：

  I/O控制器中会设置相应的**数据寄存器**。输出时，数据寄存器用于暂存CPU发来的数据，之后再由控制器传送设备。输入时，数据寄存器用于暂存设备发来的数据，之后CPU从数据寄存器中取走数据；

+ **地址识别**：

  类似于内存的地址，为了区分设备控制器中的各个寄存器，也需要给各个寄存器设置一个特定的“地址”。I/O控制器通过CPU提供的“地址”来判断CPU要读/写的是哪个寄存器。

### 6.2.3 I/O控制器的组成

I/O控制器可由三大模块组成：

+ CPU与控制器的接口：

  用于实现CPU与控制器之间的通信。CPU通过控制线发出命令；通过地址线指明要操作的设备；通过数据线来取出（输入）数据，或放入（输出）数据；

+ I/O逻辑：

  负责接收和识别CPU的各种命令（如地址译码），并负责对设备发出命令；

+ 控制器与设备的接口：

  用于实现控制器与设备之间的通信。

<img src="https://images.drshw.tech/images/notes/image-20221112162347336.png" alt="image-20221112162347336" style="zoom:50%;" />

注意：

1. 一个I/O控制器可能会对应多个设备；

2. 数据寄存器、控制寄存器、状态寄存器可能有多个（如：每个控制/状态寄存器对应一个具体的设备），且这些寄存器都要有相应的地址，才能方便CPU操作。

   有的计算机会让这些寄存器占用内存地址的一部分，称为**内存映像I/O**；另一些计算机则采用I/O专用地址，即**寄存器独立编址**。

### 6.2.4 两种寄存器编址方式

#### 内存映像I/O

即内存映射I/O，控制器中的寄存器与内存地址统一编址：

<img src="https://images.drshw.tech/images/notes/image-20221112163727024.png" alt="image-20221112163727024" style="zoom:50%;" />

#### 寄存器独立编址

即控制器中的寄存器使用单独的地址：

<img src="https://images.drshw.tech/images/notes/image-20221112164229053.png" alt="image-20221112164229053" style="zoom:50%;" />

缺点：需要设置专门的指令来实现对寄存器的操作，不仅要指明寄存器的地址，还要指明控制器的编号。

