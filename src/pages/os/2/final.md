---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

## 本章疑难点

### 为什么程序不能被调度？

因为程序是静态的，程序即使只有一次结果不再现，也是错误的。

要使结果再现，符合并发的要求，需要满足[Berstein条件](https://docs.drshw.tech/os/1/2/#bernstein%E6%9D%A1%E4%BB%B6)，但几乎不可能满足所有指令没有交集，所以一般情况下程序不能并发，也不能被调度。

### 为什么要引入进程？

因为程序不能被调度；而对于进程，它具有可描述进程的基本情况和运行状态的[PCB](https://docs.drshw.tech/os/2/1/#21-%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5)，对其进行控制和管理。

### 进程为什么可以实现并发？

因为有PCB。它是动态的过程，且在任何时候中断，信息都会存储在PCB中，不会存在问题。

### 如何实现进程控制？

使用[原语](https://docs.drshw.tech/os/2/2/#222-%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8E%9F%E8%AF%AD)实现。原语是一种特殊的条件，运行不可中断。

### 进程控制相关的原语有哪些？

[进程的创建、终止、阻塞、唤醒、切换](https://docs.drshw.tech/os/2/2/#222-%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8E%9F%E8%AF%AD)。

### 原子操作是什么

原子操作执行过程只能一气呵成，中间不允许被中断。一般使用“[关中断指令](https://docs.drshw.tech/os/2/2/#221-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5)”和“开中断指令”这两个[特权指令](https://docs.drshw.tech/os/1/4/#141-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6)实现原子性。

### 课上习题——复杂生产者消费者

某银行提供一个窗口和10个供顾客等待的座位。顾客到达银行时，若有空座位，则到取号机上领取一个号，等待叫号；否则等待有空座位产生才能取号。取号机每次仅允许一位顾客使用，当营业员空闲时，通过叫号选取一位顾客，并为其服务。顾客和营业员的活动过程描述如下：

```cpp
cobegin
{
    process 顾客i
    {
        从取号机获取一个号码;
        等待叫号;
    }
    process 营业员
    {
        while (true)
        {
            叫号;
            提供服务;
        }
    }
}coend
```

#### 分析步骤

将问题抽象化：

营业员可看作生产者进程；顾客可看作消费者进程。座位可视为一个大小为10，初始为10的缓冲区。

关系分析：

+ 互斥关系：对取号操作需要互斥地进行；

+ 同步关系（一前一后）：

  1. 当存在空座位时，顾客才能取号；
  2. 仅当所有座位不空时，营业员才能开始服务；
  3. 营业员叫号后，顾客才能获取服务；

代码实现：

```cpp
// 信号量设置
semaphore mutex=1;  //互斥使用取号机
semaphore empty=10; //空座位的数量，设置为10
semaphore full=0;   //已占座位的数量，初值为0
semaphore service=0;    //等待叫号，初始状态下银行一定是做好准备的，故设为1
// 进程操作
cobegin 
{
    process 顾客i
    {
        P(empty);   //等空位
        P(mutex);   //申请使用取号机
        从取号机获取一个号码；
        V(mutex);   //取号完毕
        P(sevice);  //等待营业员叫号
        V(full);    //通知营业员有新顾客
    }
    process 营业员{
        while(true)
        {
            P(full);    //没有顾客则休息
            叫号；
            V(empty);   //顾客离开座位，释放一个空位
            提供服务;
            V(service); //服务
        }
    }
 }coend
```
