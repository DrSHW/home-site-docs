---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

## 2.6 进程通信

进程通信就是进程之间的数据交换。

进程是分配系统资源的单位（包括内存地址空间），因此**各进程**拥有的**内存地址空间相互独立**。

为了保证安全，**一个进程不能直接访问另一个进程的地址空间**。但是，进程之间的信息交换又是必须实现的（就比如使用QQ发图片时需要访问相册）。为了保证进程间的安全通信，操作系统提供了一些方法：**共享存储**、**消息传递**和**管道通信**。

<img src="https://images.drshw.tech/images/notes/image-20221101224110209.png" alt="image-20221101224110209" style="zoom:50%;" />

### 2.5.1 共享存储

即通信的进程之间存在着一块可以直接访问的**共享空间**，通过对这块共享空间的读写操作实现进程之间的信息交换：

<img src="https://images.drshw.tech/images/notes/image-20221006123524604.png" alt="image-20221006123524604" style="zoom:50%;" />

需要注意的是，两个进程对共享空间的**访问**必须是**互斥**的（一个进程在其中写数据时，其它进程不可访问）。互斥操作可以由操作系统提供的同步互斥工具实现（如后续会讲到的`P`、`V`操作）。

共享存储也可以分为基于数据结构的共享和基于存储区的共享：

+ **基于数据结构**的共享：

  例如：共享空间里只能放一个长度为10的数组。这种共享方式速度慢、限制多，是一种**低级通信**方式。

+ **基于存储区**的共享：

  即在内存中画出一块共享存储区，数据的形式、存放位置都由进程控制，而不是操作系统。相比之下，这种共享方式**速度更快**，是一种**高级通信**方式。

### 2.5.2 管道通信

“管道”是指用于连接读写进程的一个共享文件，有名`pipe`文件。其实就是在内存中开辟一个大小固定的缓冲区：

<img src="https://images.drshw.tech/images/notes/image-20221006124738832.png" alt="image-20221006124738832" style="zoom:50%;" />

需要注意的是：

1. 管道只能采取**半双工通信**，某一时间段只能实现单向的传输。如果要实现**双向同时通信**，则**需要设置两个管道**（上图即为两个管道）；
2. 各进程需要**互斥**地访问管道；
3. 数据以字符流的形式写入管道，当**管道写满**时，**写进程**的`write()`系统将被**阻塞**，等待读进程将数据取走。当读进程将数据全部取走后，**管道变空**，此时**读进程**的`read()`系统调用将被**阻塞**。
4. 如果**没有写满，就不允许读**。如果**没有读空，就不允许写**。
5. 数据一旦被读出，就从管道中被抛弃，这就意味着**读进程最多只能有一个**，否则可能会有读错数据的情况。

### 2.5.3 消息传递

进程间的数据交换以**格式化的消息**（Message）为单位。进程通过操作系统提供的“发送消息 / 接收消息”两个**原语**进行数据交换。

消息的结构：

<img src="https://images.drshw.tech/images/notes/image-20221006125410161.png" alt="image-20221006125410161" style="zoom:50%;" />

消息传递分为直接通信方式和间接通信方式：

+ **直接通信**方式：

  消息直接挂到接收进程的消息缓冲队列上；

+ **间接通信**方式：

  消息要先发送到中间实体（信箱）中，因此也称“信箱通信方式”。（例如计网中的电子邮件系统）