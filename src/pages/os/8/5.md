---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

## 8.5 磁盘的管理

<img src="https://images.drshw.tech/images/notes/image-20221115003305766.png" alt="image-20221115003305766" style="zoom:50%;" />

### 8.5.1 磁盘初始化

计算机开机时需要进行一系列初始化的工作，这些初始化工作是通过执行**初始化程序**（**自举程序**）完成的。

初始化程序可以放在ROM（只读存储器，一般出厂时就集成在主板上了）中。ROM中的数据在出厂时就写入了，并且**以后不能再修改**。

磁盘初始化的步骤如下：

1. 进行**低级格式化（物理格式化）**，将磁盘的各个磁道**划分为扇区**。一个扇区通常可分为头、数据区域（如512B大小）、尾 三个部分组成。管理扇区所需要的各种数据结构一般存放在头、尾两个部分，包括扇区校验码（如奇偶校验、CRC循环冗余校验码等，校验码用于校验扇区中的数据是否发生错误）：

   <img src="https://images.drshw.tech/images/notes/image-20221115004040813.png" alt="image-20221115004040813" style="zoom:50%;" />

2. 将磁盘分区，每个分区由若干柱面组成（即分为我们熟悉的C盘、D盘、E盘）：

   <img src="https://images.drshw.tech/images/notes/image-20221115004015278.png" alt="image-20221115004015278" style="zoom:50%;" />

3. 进行**逻辑格式化**，创建文件系统。包括创建文件系统的根目录、初始化存储空间管理所用的数据结构( 如位示图、空闲分区表)

### 8.5.2 引导块

若完整的初始化程序（自举程序）存放在ROM中，一旦要更新初始化程序，将会很不方便，因为ROM中的数据无法更改。可以将完整的初始化程序放在磁盘的启动块（即引导块/启动分区，例如C盘）上，启动块位于磁盘的固定位置；而ROM中仅存放很小的“自举装入程序”。

这样，开机时计算机先运行“自举装入程序”，通过执行该程序就可以找到引导块，并将完整的“自举程序”读入内存，完成初始化。

### 8.5.3 坏块的管理

坏块指那些损坏的、无法正常使用的扇区。这属于硬件故障，操作系统是无法修复的。应该将坏块标记出来，以免错误地使用到它。

对于简单的磁盘，可以在逻辑格式化时（建立文件系统时）对整个磁盘进行坏块检查，标明哪些扇区是坏扇区。例如：在FAT表上标明。（在这种方式中，**坏块对操作系统不透明**）

对于复杂的磁盘，磁盘控制器（设备内部的一个硬件部件）会维护一个坏块链表。在磁盘出厂前进行低级格式化（物理格式化）时就将坏块链进行初始化。

会保留一些“备用扇区”，用于替换坏块。这种方案称为**扇区备用**。且这种处理方式中，**坏块对操作系统透明**。