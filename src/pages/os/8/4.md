---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

## 8.4 减少磁盘延迟时间的方法

磁头读取一块的内容（也就是一个扇区的内容）后，需要一小段时间处理，而盘片又在不停地旋转。

因此，若要连续读取2、3号扇区，且它们相邻排列，则读完2号扇区后无法连续不断地读入3号扇区；必须等盘片继续旋转，3号扇区再次划过磁头，才能完成扇区读入。

结论：磁头读入一个扇区数据后需要一小段时间处理，如果逻辑上相邻的扇区在物理上也相邻，则读入几个连续的逻辑扇区，可能需要很长的“延迟时间”。

可以采用交替编号、错位命名、合理的磁盘地址结构设计减少延迟时间：

![image-20221114232446405](https://images.drshw.tech/images/notes/image-20221114232446405.png)

### 8.4.1 交替编号

若采用交替编号的策略，即让逻辑上相邻的扇区在物理上有一定的间隔，可以使读取连续的逻辑扇区所需要的延迟时间更小。

示例：若初始情况下磁头指向0号扇区：

<img src="https://images.drshw.tech/images/notes/image-20221114235402544.png" alt="image-20221114235402544" style="zoom:50%;" />

假设需要读入2、3、4号扇区，读入2号扇区后，磁头状态如下：

<img src="https://images.drshw.tech/images/notes/image-20221114235620208.png" alt="image-20221114235620208" style="zoom:50%;" />

读完后，磁头需要准备一段时间才能读入下一个扇区；由于采用了交替编号的策略，磁头在划过3号扇区前有了缓冲时间（中间间隔了6号扇区），到达时可以直接读入3号扇区，无需再转一圈。

### 8.4.2 磁盘地址结构设计

上节中提到，磁盘的物理地址可表示为`(柱面号, 盘面号, 扇区号)`，那么能否表示为`(盘面号, 柱面号, 扇区号)`呢？

假设某磁盘有8个柱面/磁道（假设最内侧柱面/磁道号为0），4个盘面，8个扇区。则可用3个二进制位表示柱面，2个二进制位表示盘面，3个二进制位表示扇区。

**若物理地址结构为`(盘面号, 柱面号, 扇区号)`**，且需要连续读取物理地址`(00, 000, 000) ~ (00, 001, 111)`的扇区：

+ `(00, 000, 000) ~ (00, 000, 111)`转两圈可读完；
+ 之后再读取物理地址相邻的区域，即`(00, 001, 000) ~ (00, 001, 111)`，**需要启动磁头臂，将磁头移动到下一个磁道**。

**若物理地址结构为`(柱面号, 盘面号, 扇区号)`**，且需要连续读取物理地址`(000, 00, 000) ~ (000, 01, 111)`的扇区：

+ `(000, 00, 000) ~ (000, 00, 111)`，由盘面0的磁头读入数据，转两圈可读完；
+ 之后再读取物理地址相邻的区域，即`(000, 01, 000) ~ (000, 01, 111)`，**由于柱面号/磁道号相同，只是盘面号不同，因此不需要移动磁头臂，只需要激活相邻盘面的磁头即可**。

因此，读取地址连续的磁盘块时，采用`(柱面号, 盘面号, 扇区号)`的地址结构可以减少磁头移动消耗的时间。

### 8.4.3 错位命名

若相邻盘面**相对位置相同处扇区编号相同**，磁盘初始状态如下：

<img src="https://images.drshw.tech/images/notes/image-20221115001813302.png" alt="image-20221115001813302" style="zoom:50%;" />

若读取完磁盘块`(000, 00, 111)`之后，需要短暂的时间处理，而盘面又在不停地转动（所有盘面都是一起连轴转的）。因此当`(000, 01, 000)`第一次划过1号盘面的磁头下方时，并不能读取数据，只能再等该扇区再次划过磁头：

<img src="https://images.drshw.tech/images/notes/image-20221115002249409.png" alt="image-20221115002249409" style="zoom:50%;" />

可引入错位命名的方式改善这种问题，示例：

若此时0号盘面的正下方为7号扇区，7号盘面的正下方为3号扇区（**错位命名**），如下图：

<img src="https://images.drshw.tech/images/notes/image-20221115002759769.png" alt="image-20221115002759769" style="zoom:50%;" />

由于采用错位命名法，因此读取完磁盘块`(000, 00, 111)`之后，还有一段时间处理；当`(000, 01, 000)`第一次划过1号盘面的磁头下方时，就可以直接读取数据，从而减少延迟时间：

<img src="https://images.drshw.tech/images/notes/image-20221115003027791.png" alt="image-20221115003027791" style="zoom:50%;" />