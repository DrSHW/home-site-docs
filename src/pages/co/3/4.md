---
description: 组成原理
layout: ../../../layouts/MainLayout.astro
---

## 3.4 外部存储器

### 3.4.1 磁盘存储器

<img src="https://images.drshw.tech/images/notes/image-20230318213444490.png" alt="image-20230318213444490" style="zoom:50%;" />

#### 磁盘存储器的工作原理与特性

计算机的外存储器又称为辅助存储器，目前主要使用磁表面存储器。外存储器既可以作为输入设备，也可以作为输出设备（既可以存数据，也可以读数据）

所谓“磁表面存储”，是指把某些磁性材料薄薄地涂在金属铝或塑料（盘片）表面上作为载磁体来存储信息。磁盘存储器、磁带存储器和磁鼓存储器均属于磁表面存储器。

<img src="https://images.drshw.tech/images/notes/image-20230318211548767.png" alt="image-20230318211548767" style="zoom:50%;" />

> 读写不可同时进行。磁头划过存储体表面时，每次读出1bit信息。

磁表面存储器的优点：

1. 存储容量大，位价格低；
2. 记录介质可以重复使用；
3. 记录信息可以长期保存而不丢失，甚至可以脱机存档；
4. 非破坏性读出，读出时不需要再生。

磁表面存储器的缺点：

1. 存取速度慢；
2. 机械结构复杂；
3. 对工作环境要求较高。

#### 磁盘设备的组成

磁盘设备可由**存储区域**与**硬盘存储器**组成。

硬盘存储器由磁盘驱动器（机械部分）与磁盘控制器（电路部分）和盘片组成。

磁盘驱动器：核心部件是磁头组件和盘片组件，温彻斯特盘是一种可移动头固定盘片的硬盘存储器。

<img src="https://images.drshw.tech/images/notes/image-20230318212407443.png" alt="image-20230318212407443" style="zoom:50%;" />

> 在电路板的控制下，驱动轴使盘片不断旋转，磁头臂通过移动读（写）磁头读取（写入）盘片上的信息。
>
> 微观结构如下：
>
> <img src="https://images.drshw.tech/images/notes/image-20230318213802937.png" alt="image-20230318213802937" style="zoom:50%;" />

磁盘控制器：是硬盘存储器和主机的接口，主流的标准有IDE、SCSI、SATA等。

<img src="https://images.drshw.tech/images/notes/image-20230318212342515.png" alt="image-20230318212342515" style="zoom: 67%;" /><img src="https://images.drshw.tech/images/notes/image-20230318212626686.png" alt="image-20230318212626686" style="zoom: 67%;" />

而存储区域中，一块硬盘含有若干个记录面，每个记录面划分为若干条磁道，而每条磁道又划分为若干个扇区，扇区（也称块）是磁盘读写的最小单位，也就是说磁盘按块存取。

存储区域中的磁头数、柱面数、扇区数：

<img src="https://images.drshw.tech/images/notes/image-20230318214206545.png" alt="image-20230318214206545" style="zoom:50%;" />

在[操作系统篇——磁盘管理](https://docs.drshw.tech/os/8/3/#831-%E7%A3%81%E7%9B%98%E7%9A%84%E7%BB%93%E6%9E%84)一章中，会有更为详尽的解释。

#### 磁盘的性能指标

1. 磁盘的容量：一个磁盘所能存储的字节总数称为磁盘容量。磁盘容量有**非格式化容量**和**格式化容量**之分。
   + 非格式化容量是指：磁记录表面可以利用的磁化单元总数。
   + 格式化容量是指：按照某种特定的记录格式所能存储信息的总量。
2. 记录密度：记录密度是指盘片单位面积上记录的二进制的信息量，通常以**道密度**、**位密度**和**面密度**表示。
   + 道密度是沿磁盘半径方向单位长度上的磁道数；
   + 位密度是磁道单位长度上能记录的二制代码位数；
   + **面密度**是位密度和道密度的**乘积**。

<img src="https://images.drshw.tech/images/notes/image-20230318214926865.png" alt="image-20230318214926865" style="zoom:50%;" />

> 注意：磁盘所有磁道记录的信息量一定是相等的，并不是圆越大信息越多，故每个磁道的位密度都不同：
>
> <img src="https://images.drshw.tech/images/notes/image-20230318214938040.png" alt="image-20230318214938040" style="zoom:50%;" />

3. 平均存取时间：

   **平均存取时间** = 寻道时间（磁头移动到目的磁道）+  旋转延迟时间（磁头定位到所在扇区）+ 传输时间（传输数据所花费的时间）。

   <img src="https://images.drshw.tech/images/notes/image-20230318215533034.png" alt="image-20230318215533034" style="zoom:50%;" />

4. 数据传输率：磁盘存储器在单位时间内向主机传送数据的字节数，称为**数据传输率**。

   假设磁盘转数为`r`（转/秒），每条磁道容量为`N`个字节，则数据传输率为<img src="https://images.drshw.tech/images/notes/image-20230318215645657.png" alt="image-20230318215645657" style="zoom:60%;" />。

#### 磁盘的地址结构

主机向磁盘控制器发送寻址信息，磁盘的地址一般如图所示：

<img src="https://images.drshw.tech/images/notes/image-20230318215918666.png" alt="image-20230318215918666" style="zoom:50%;" />

例如，若系统中有4个驱动器，每个驱动器带一个磁盘，每个磁盘256个磁道、16个盘面，每个盘面划分为16个扇区，则每个扇区地址要18位二进制代码：

<img src="https://images.drshw.tech/images/notes/image-20230318220045614.png" alt="image-20230318220045614" style="zoom:50%;" />

#### 硬盘的工作过程

硬盘的主要操作是寻址、读盘、写盘。每个操作都对应一个控制字，硬盘工作时，第一步是取控制字，第二步是执行控制字。

硬盘属于机械式部件，其读写操作是串行的，不可能在同一时刻既读又写，也不可能在同一时刻读两组数据或写两组数据。因此需要设置串并变换电路（可以一次输入多比特数据，但一次只能读/写1bit信息）：

<img src="https://images.drshw.tech/images/notes/image-20230318220336596.png" alt="image-20230318220336596" style="zoom: 67%;" />

#### 磁盘阵列

廉价余**磁盘阵列RAID**（Redundant Array of lnexpensive Disks）是将多个独立的物理磁盘组成一个独立的逻辑盘，数据在多个物理盘上分制交叉存储、并行访问，具有更好的**存储性能、可靠性和安全性**。

RAID的分级如下几种分级方式。在RAID1~RAID5的几种方案中，无论何时有磁盘损坏，都可以随时拔出受损的磁盘再插入好的磁盘，而数据不会损坏：

+ RAID0：无冗余和无校验的磁盘阵列

  如下图，若给出两个磁盘，`A1, A2`、`A3, A4`表示**逻辑上相邻**的两组数据：

  <img src="https://images.drshw.tech/images/notes/image-20230319214648032.png" alt="image-20230319214648032" style="zoom:50%;" />

  若要读取数据，可以同时读取两块磁盘中逻辑相邻的部分（内容是一样的），以提升读取效率（并行读取）。

  物理磁盘数也可以按需求增加：

  <img src="https://images.drshw.tech/images/notes/image-20230319214801678.png" alt="image-20230319214801678" style="zoom:50%;" />

  局限性：当磁盘的某些扇区损坏时，磁盘读取的信息存在差错。需要设置一些冗余位来发现错误，并恢复这些数据。

  > 总结：RAID0把连续多个数据块交替地存放在不同物理磁盘的扇区中，几个磁盘交叉并行读写，不仅扩大了存储容量，而且提高了磁盘数据存取速度，但RAID0**没有容错能力**。

+ RAID1：镜像磁盘阵列

  即采用**多份存储阵列**，对磁盘中的数据进行备份（镜像）：

  <img src="https://images.drshw.tech/images/notes/image-20230319215140232.png" alt="image-20230319215140232" style="zoom:50%;" />

  读取时磁盘若发生损坏，或经对比发现数据不一致的问题，可读取镜像磁盘中的内容，提升了存储的可靠性。

  局限性：浪费一半存储空间，存储空间利用率差。

  > 总结：RAID1是为了提高可靠性，使两个磁盘同时进行读写，互为备份，如果一个磁盘出现故障，可从另一磁盘中读出数据。两个磁盘当一个磁盘使用，意味着容量减少一半。

+ RAID2：采用纠错的海明码的磁盘阵列

  逻辑上连续的几个bit，通过物理上分散的方式存储在各个盘中，由4bit信息位+3bit**海明校验位**组成，可**纠正一位错**。

  <img src="https://images.drshw.tech/images/notes/image-20230319215400363.png" alt="image-20230319215400363" style="zoom:50%;" />

  此时若磁盘发生的损坏或字节跳变，通过校验位的信息可将异常位恢复。

  **注：海明校验码见计算机网络一章中（暂时还没写），计组中已不作要求。**

+ RAID3：位交叉奇偶校验的磁盘阵列

+ RAID4：块交叉奇偶校验的磁盘阵列

+ RAID5：无独立校验的奇偶校验磁盘阵列

后三种不在大纲范围内，暂不作讲解。

### 3.4.2 固态硬盘SSD

<img src="https://images.drshw.tech/images/notes/image-20230320145049340.png" alt="image-20230320145049340" style="zoom:50%;" />

#### 固态硬盘的结构

与机械硬盘不同，固态硬盘是基于[闪存技术](https://docs.drshw.tech/co/3/2/#323-%E5%8F%AA%E8%AF%BB%E5%AD%98%E5%82%A8%E5%99%A8rom)（Flash Memory）存储数据的。

<img src="https://images.drshw.tech/images/notes/image-20230320145210213.png" alt="image-20230320145210213" style="zoom:50%;" />

其结构如下图所示：

<img src="https://images.drshw.tech/images/notes/image-20230320145644108.png" alt="image-20230320145644108" style="zoom:50%;" />

说明：

+ **闪存翻译层**用于**地址变换**：

  系统通过I/O总线向SSD发出需要度读/写的逻辑块号，该逻辑地址经过闪存翻译层，映射为某一个具体的物理地址。

  因此，固态硬盘支持**随机访问**。

+ **闪存芯片**即存储体，用于保存数据：

  每一块闪存芯片由一个个**块**组成，每个块又可进一步拆解为一个个**页**，每个页的大小约为512B~4KB。

#### 固态硬盘的读写性能

固态硬盘的**读写以页为单位**（机械硬盘中则为一个块或扇区），相比之下，固态硬盘的一个块相当于机械硬盘的一个磁道。

若某个页已经被写入数据，欲擦除并重写该页数据，需要将该页**所在块中数据全部擦除**后，才可实现重写（原先其他页中数据需要被**恢复**）。

数据恢复的过程也很简单，在擦除该块前，系统会将该块其他数据**复制**到另一块空存储体对应的位置，并在新块中对应目标页**写入**需要更改的值。闪存翻译层会**记录新块与逻辑地址的映射**，并将原有映射**舍弃**。

#### 固态硬盘与机械硬盘的对比

见本节思维导图。

#### 磨损均衡技术（操作系统考点，这里讲掉了）

若不采用磨损均衡技术，可能会多次向同一个块中写入数据。擦除数据对一个块来说代价较大，这将导致该块容易损坏。

磨损均衡技术就是记录某块被擦除的次数，若被擦除的次数较多，则会通过闪存翻译层，**更改该块的地址映射**至其他被擦除次数很少的块，提升原块的使用寿命。

磨损均衡技术可分为**动态/静态磨损均衡技术**：

+ 动态磨损均衡：动态地记录每块**被擦除的次数**，选择被擦除更少的块作为新地址映射。
+ 静态磨损均衡：通过记录每块的**读写次数**，将经常被读，很少被写的块迁移至老旧的块中。（这里的老旧指存取寿命少，即被擦除更多次的块）

> 虽然说固态硬盘的块擦除会影响该块的寿命，但是理想情况下，这对固态硬盘的总体寿命来讲可以忽略不计，看个例子：
>
> <img src="https://images.drshw.tech/images/notes/image-20230320153102291.png" alt="image-20230320153102291" style="zoom:50%;" />
