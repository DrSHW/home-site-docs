---
description: 组成原理
layout: ../../../layouts/MainLayout.astro
---

## 3.2 主存储器

### 3.2.1 主存储器的基本组成

<img src="https://images.drshw.tech/images/notes/image-20230314202625745.png" alt="image-20230314202625745" style="zoom:50%;" />

#### 基本半导体元件及其原理

存储器由若干个存储元组成，每个存储元的构造如下图：

<img src="https://images.drshw.tech/images/notes/image-20230314223020044.png" alt="image-20230314223020044" style="zoom:50%;" />

> MOS管可理解为一种电控开关，它有三个极（S、G和D），当G与S之间的输入电压达到某个阈值时，MOS管就可以接通。
>
> 当MOS管达到导通电压，且D极（即导线另一端）为正向高电压时，电容器会充电（接地电压为0V，两极板之间产生了电压差）。
>
> 由此，可以根据电容器中是否保存电荷，来确定此时的状态为二进制信号0/1。（下面假设保存了电荷为1，否则为0）
>
> + 当想要读取存储元中的信息时，对MOS管G与S之间施加导通电压，对导线另一端不施加电压：
>   + 此时若电容器中保存电荷，电容器会放电，表示信号1；同时电容器中的电荷流出，相当于写入0；
>   + 若未保存电荷，则不放电；此时表示信号0；
>   + 这种读出为**破坏性读出**，即每次读出时，若读取到信号为1，代表电容中原本存在电荷，读出时将其放走了，需要进行**重写**（再生）操作。
> + 若想要写入存储元中的信息1，只需对MOS管G与S之间施加导通电压，并在导线另一端（D）施加高电压即可实现。
> + 由于采用电容存储信息，电容中的电荷会随着时间慢慢流失（通常只能维持2ms），故需要周期性地对电容器采取**刷新**操作，维护其中的电荷。
>
> 这种存储元也被称为**栅极电容**存储元。

当多个存储元被合理地连接，即可一次性读出/写入多个二进制信息：

<img src="https://images.drshw.tech/images/notes/image-20230314204428545.png" alt="image-20230314204428545" style="zoom: 67%;" />

上图中，每条红线用于控制该行存储元中MOS管G与S之间的电压，即判断MOS管是否导通；每条绿线用于控制该列读出/写入二进制信息。每一行构成一个**存储单元**，多个存储单元则构成一个**存储体**。每次读出的二进制位被称为**存储字**：

<img src="https://images.drshw.tech/images/notes/image-20230314223734881.png" alt="image-20230314223734881" style="zoom:50%;" />

#### 存储器芯片的基本原理

存储器芯片的基本运作流程如下图：

<img src="https://images.drshw.tech/images/notes/image-20230315144101535.png" alt="image-20230315144101535" style="zoom:67%;" />

说明：

1. 存储矩阵：即一个个存储单元，上文提过了。

2. 译码器：可将`n`位二进制值与`2^n`种选通信号产生映射；

   例如上图中的`3-8`译码器，即输入3个二进制值，输出8种信号，举个例子：

   + 输入`010`，则第2根（编号从0开始）输出（选通）线上产生信号，其余输出线均无信号产生。

   利用地址寄存器中给出的地址，即可通过**地址译码器**，将MAR中保存的地址与相对应的**字选线**（译码器输出）关联起来。

   图中MAR中内容为`000`，因此第0根字选线将被选通，此时通过**数据线**（位线，即图中的绿线），即可读出第一行存储单元每一位信号。

3. 控制电路：

   + 作用一：电信号在读写时通常是不稳定的，只有当MAR中电信号稳定后，控制电路才会允许MAR将信息送入译码器。同理，译码器与MDR也需要控制电路，保持电信号的稳定。

   + 作用二：提供**片选信号**（如图中的<img src="https://images.drshw.tech/images/notes/image-20230315143035229.png" alt="image-20230315143035229" style="zoom:50%;" />，上划线代表**低电平有效**），选通即代表选择了该芯片，该芯片可以工作，相当于总开关。

     > 一个内存条中常会有多块内存芯片，一般不会全部同时工作。只有接收到CPU发出了片选信号后，芯片才会工作。

   + 作用三：**读写控制**。根据控制电路型号的不同，读写控制线有一根或两根。读写控制线的标记如上图所示，当读控制线有效时，才可进行读操作；当写控制线有效时，才可进行写操作。

于是，存储器芯片基础模块可抽象为如下结构：

<img src="https://images.drshw.tech/images/notes/image-20230314224244187.png" alt="image-20230314224244187" style="zoom:50%;" />

#### 寻址

关于按字节、按半字、按字、按双字寻址的原理与转换，在[2.2节](https://docs.drshw.tech/co/2/2/#%E8%BE%B9%E7%95%8C%E5%AF%B9%E9%BD%90)已经说明过了。

这里再举个例子，若有1K个存储单元，存储字长8bit，则：

+ 按字节寻址：看作1K个单元，每个单元1B；
+ 按字寻址：看作256个单元，每个单元4B；
+ 按半字寻址：看作512个单元，每个单元2B；
+ 按双字寻址：128个单元，每个单元8B。

可通过左移位的方式，将其它寻址方式转换为按字节寻址。

### 3.2.2 SRAM和DRAM

DRAM芯片，即由上节提到的存储元构成，使用**栅极电容**存储信息。

而SRAM芯片中的存储元则使用**双稳态触发器**存储信息，具体结构如下图：

<img src="https://images.drshw.tech/images/notes/image-20230315150055508.png" alt="image-20230315150055508" style="zoom:50%;" />

> 说明：
>
> 初始状态下，WL为低电平，M5、M6均截止；且VDD保持为高电平。
>
> 当B点电压`VB = VDD`时，表示信号0；A点电压`VA = VDD`时，表示信号1；（A、B点电压不会同时为高电平或低电平）
>
> 要写入数据时，则将WL置为高电平，此时M5、M6均导通：
>
> + 若要写入信号0，则需将左线BL置为低电平，右线BLX置为高电平。
>
>   由于M5导通，因此A点电压`VA = VBL = 0V`，为低电平，此时M4中G与S之间为低电平。
>
>   而M4为低电平导通MOS管（有空心小圆圈），故M4导通，B点电压`VB = VDD`，为高电平。
>
>   M2的G与S之间为低电平，截止。断开WL电压，M5、M6均截止，VB保持高电平稳态，写入完毕。
>
> + 若要写入信号0，则需将右线BLX置为低电平，左线BL置为高电平。相关分析同上，最终VA保持高电平稳态。
>
> 要读出数据时，则将WL置为高电平，此时M5、M6均导通：
>
> + 若VB为高电平（读0），此时M6导通，右线BLX为高电平；
>
>   此时M3管截止，M1管导通，故`VA = V地 = 0`，为低电平；M5导通，左线BL为低电平；
>
> + 若VB为高电平（读1），同理，分析结果为左线BL为高电平，右线BLX为低电平。

总之，当字选择线WL接通时：

+ 当左线BL输出低电平时，表示读出0；当左线BL输出低电平时，表示读出1。
+ 给左线**BL施加低电平**，右线**BLX施加高电平**，即可写入**信号0**；给左线**BL施加高电平**，右线**BLX施加低电平**，即可写入**信号1**；

> 1：左高右低；
> 0：左低右高。

由于双稳态触发器读出数据时，触发器状态保持稳定，是**非破坏性读出**（与栅极电容相比），无需重写、刷新，因此**读写速度更快**。

对于栅极电容，每个存储元制造成本更低，集成度高，功耗低，常用作主存；对于双稳态触发器，每个存储元制造成本更高，集成度低，功耗大，常用作Cache。

于是，关于两者的特性，可总结为：

<img src="https://images.drshw.tech/images/notes/image-20230315151625465.png" alt="image-20230315151625465" style="zoom:50%;" />

> 一些Q & A：
>
> 1. 使用栅极电容存储元时，多久需要进行一次刷新操作？
>
>    + 刷新周期一般为 2ms。
>
> 2. 每次需要刷新多少个存储单元？
>
>    + 以行为单位，每次刷新一行的存储单元。
>
> 3. 为什么要采用二维的行列地址？
>
>    若采用一维的地址，则需要一个`n-2^n`译码器，通常存储单元数目很大，因此译码器也需要的非常多的输出引脚，不便于集成：
>
>    <img src="https://images.drshw.tech/images/notes/image-20230315152224972.png" alt="image-20230315152224972" style="zoom:50%;" />
>
>    若采用行列地址，则只需采用`n/2-2^(n/2)`规格的行地址与列地址译码器，大大方便了译码电路的集成。
>
>    当行地址译码器与列地址译码器同时选中一个存储单元时，该存储单元即可工作：
>
>    <img src="https://images.drshw.tech/images/notes/image-20230315152604868.png" alt="image-20230315152604868" style="zoom:50%;" />
>
> 4. 如何刷新？
>
>    + 有硬件支持，读出一整行的信息后重新写入，占用1个读/写周期。（**由存储器独立完成，无需CPU控制**）
>
> 5. 在什么时刻刷新？
>
>    假设DRAM内部结构排列成128 * 128的形式，读/写周期0.5μs，假设2ms刷新一次，即`2ms / 0.5μs = 4000`个周期：
>
>    + 思路一，每读写完毕都会刷新一行：
>
>      即前0.5μs时间用于正常读写，后0.5μs时间用于刷新某行。
>
>      这种刷新方式被称为**分散刷新**：
>
>      <img src="https://images.drshw.tech/images/notes/image-20230315182129114.png" alt="image-20230315182129114" style="zoom:50%;" />
>
>    + 思路二，2ms内集中安排时间全部刷新：
>
>      即系统的存取周期还是0.5μs，有一段时间无法刷新，无法访问存储器，称为访存“死区”。
>
>      这种刷新方式被称为**集中刷新**：
>
>      <img src="https://images.drshw.tech/images/notes/image-20230315182359130.png" alt="image-20230315182359130" style="zoom:50%;" />
>
>    + **思路三**，2ms内每行刷新1次即可：
>
>      即2ms内需要产生128次刷新请求，每隔`2ms/128 = 15.6μs`一次，每15.6μs内有0.5μs的“死时间”。
>
>      + 可以充分利用死时间，比如在译码的阶段刷新，以减少CPU空转时间。
>
>      这种刷新方式被称为**异步刷新**：
>
>      <img src="https://images.drshw.tech/images/notes/image-20230315182715895.png" alt="image-20230315182715895" style="zoom:50%;" />

#### DRAM的地址线复用技术

对于SRAM来说，行列地址信息是同时送入译码器的，此时若行、列地址均有n/2位，芯片需要`n/2 * 2 = n`个引脚（n条地址线）。

而DRAM采用了地址线复用技术，会先读取行地址信息，将行地址信息送入行地址缓冲器中；再读取列地址，送入列地址缓冲器中；再分别将两地址缓冲器中的内容送入译码电路：

<img src="https://images.drshw.tech/images/notes/image-20230315183449396.png" alt="image-20230315183449396" style="zoom:50%;" />

由于每次只需要读取n/2位信息，故只需要n/2条地址线，n/2条引脚。

> 现在的主存通常采用SDRAM芯片。
>
> 【科普】SDRAM是“同步动态随机存取存储器”的缩写。它是一种动态随机存储器（DRAM）的变种，具有高速、高密度和低功耗的特点。与传统DRAM相比，SDRAM可以通过在读取和写入时与计时信号同步来提高速度和可靠性。它还采用了预取技术，可以在不需要CPU参与的情况下自动预取数据，从而进一步提高访问速度。SDRAM在计算机内存、图形处理器和嵌入式系统等领域得到广泛应用。

### 3.2.3 只读存储器ROM

<img src="https://images.drshw.tech/images/notes/image-20230315184103706.png" alt="image-20230315184103706" style="zoom:50%;" />

#### 了解各种ROM

##### MROM（Mask Read-Only Memory）—— 掩膜只读存储器

特点：厂家按照客户需求，在芯片生产过程中直接写入信息，之后**任何人不可重写**（只能读出）可靠性高、灵活性差、生产周期长、只适合批量定制。

##### PROM （Programmable Read-Only Memory）—— 可编程只读存储器

特点：用户可用专门的PROM写入器写入信息，**写一次之后就不可更改**。

##### EPROM（Erasable Programmable Read-Only Memory）—— 可擦除可编程只读存储器

特点：允许用户写入信息，之后用某种方法擦除数据，**可进行多次重写**。

**UVEPROM**（ultraviolet rays）—— 用紫外线照射8~20分钟，擦除**所有**信息。

**EEPROM**（也常记为E^2PROM，第一个E是Electrically）—— 可用“电擦除”的方式，擦除**特定的字**。

##### Flash Memory —— 闪速存储器

在EEPROM基础上发展而来，特点是断电后也能保存信息，且**可进行多次快速擦除重写**。

> U盘、SD卡就是闪存。
>
> 其中，每个存储元只需单个MOS管，位密度比RAM高。
>
> 由于闪存需要**先擦除再写入**，因此闪存的**“写”速度要比“读”速度更慢**。


##### SSD（Solid State Drives）—— 固态硬盘

由控制单元+存储单元（Flash 芯片）构成，与闪速存储器的核心区别在于控制单元不一样，但存储介质都类似，**可进行多次快速擦除重写**。SSD速度快、功耗低、价格高。目前个人电脑上常用SSD取代传统的机械硬盘。

> 手机辅存也使用Flash芯片，但相比SSD使用的芯片集成度高、功耗低、价格贵。

#### 计算机内的重要ROM

计算机中的操作系统程序在开机时，需要重新从辅存中调入主存（主存关机后数据全部丢失），这通常由主板上的**BIOS芯片**负责。

BIOS芯片是一种ROM芯片，其中存储了“自举装入程序”，负责**引导装入操作系统**。

我们常说“内存条”就是“主存”，但事实上，主板上的ROM芯片也是“主存”的一部分。因此在逻辑上，主存由RAM+ROM组成，且两者常**统一编址**。

> 注意几点：
>
> + 很多ROM芯片虽然名字是“Read-Only”，但**很多ROM也可以“写”**；
> + **闪存的写速度一般比读速度更慢**，因为写入前要先擦除；
> + RAM芯片是易失性的，ROM芯片是非易失性的。很多**ROM也具有“随机存取”的特性**。
