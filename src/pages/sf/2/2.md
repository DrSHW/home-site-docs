---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

# 用户注册业务的实现、接口规范与跨域

## 定义用户模型类

按照之前讲的模型类定义方式，若用户数据表包括`id`、`username`、`password`、`mobile_phone`字段，可以这样定义：

```python
class User(models.Model):
    username = models.CharField(max_length=20, verbose_name="用户名")
    password = models.CharField(max_length=20, verbose_name="密码")
    mobile = models.CharField(max_length=11, verbose_name="手机号")
```

但是一般来说，密码需要经过加密存储，加密这种操作是可以通过调用Django提供的函数实现的。

这里我们也可以直接使用Django**默认用户认证系统**实现用户类，其中用户的密码是默认通过[`pbkdf2_sha256`算法](https://docs.drshw.tech/pw/js_decryption/02/#sha%E7%B3%BB%E5%88%97)加密的，较为安全。

#### Django默认用户认证系统

Django自带的用户认证系统会处理用户账号、组、权限以及基于Cookie的用户会话，以下了解即可：

Django认证系统模块：

+ `django.contrib.auth`包含认证框架的核心和默认的模型；

- `django.contrib.contenttypes`是Django内容类型系统，它允许权限与你创建的模型关联。

Django认证系统**同时处理认证和授权**：

- 认证：验证一个用户是否它声称的那个人，可用于账号登录；
- 授权：授权决定一个通过了认证的用户被允许做什么。

Django认证系统包含的内容：

- 用户：**用户模型类**、用户认证；
- 权限：标识一个用户是否可以做一个特定的任务，MIS系统常用到；
- 组：对多个具有相同权限的用户进行统一管理，MIS系统常用到；
- 密码：一个可配置的密码哈希系统，设置密码、密码校验。

#### Django默认用户模型类

Django认证系统中提供了用户模型类`User`保存用户的数据。

- **`User`对象是认证系统的核心**，也就是Django admin中用到的用户模型类。

Django认证系统用户模型类在`django.contrib.auth.models.User`包中，其父类为`AbstractUser`类。

User对象基本属性：

- 创建用户必传属性：`username、password`；
- 创建用户可传属性：`email、first_name、last_name、last_login、date_joined、is_active 、is_staff、is_superuse`；
- 判断用户是否通过认证：`is_authenticated`

可通过以下方式创建用户：

```python
user = User.objects.create_user(username, email, password, **extra_fields)
```

可通过以下方法进行用户认证：

```python
from django.contrib.auth import authenticate
user = authenticate(username=username, password=password, **kwargs)
```

处理密码的方法：

- 设置密码：`set_password(raw_password)`
- 校验密码：`check_password(raw_password)`

####  自定义用户模型类

由于`User`类中的字段种类有限，我们需要通过其父类`AbstractUser`自定义用户模型。

`AbstractUser`中已经包括一些基本信息，也可继续添加自定义字段，例如需要电话号码`mobile_phone`字段，可以这样声明用户模型类：

```python
from django.db import models
from django.contrib.auth.models import AbstractUser

# Create your models here.
class User(AbstractUser):
    """自定义用户模型类"""
    mobile_phone = models.CharField(max_length=11, unique=True, verbose_name='手机号')

    class Meta:
        db_table = 'tb_users'
        verbose_name = '用户'
        verbose_name_plural = verbose_name

    def __str__(self):
        return self.username
```
