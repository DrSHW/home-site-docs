---
description: Docs intro
layout: ../../../layouts/MainLayout.astro
---

# 初识 Django

## 什么是Web程序框架

### Web应用程序处理流程

目前，Web应用程序都采用**B/S架构**（Browser/Server），即只安装维护一个服务器(Server)，而客户端采用浏览器(Browse)运行软件。

其处理流程如下：

<img src="https://images.drshw.tech/images/notes/web.png" alt="img" style="zoom:40%;" />

### 为什么需要Web程序框架

在[Python网络编程](https://docs.drshw.tech/pw/introduction/)中，我们已经了解过`HTTP`协议，会使用一些模块(`request`、`httpx`)，甚至是`socket`套接字发送基本的`HTTP`请求了。其实，有了这些就足以搭建一个Web应用程序了，为什么还要引入框架呢？

Web程序框架旨在更简易而高效地搭建一个Web应用程序，这意味着我们只需要写更少的代码，即可实现目标。Web程序框架免去了不同Web应用相同代码部分的重复编写，因此程序员只需关心Web应用核心的业务逻辑实现。

### Web应用程序的本质

- 接收并解析HTTP请求，获取具体的请求信息；
- 处理本次HTTP请求，即完成本次请求的业务逻辑处理；
- 构造并返回处理结果——HTTP响应。

我们在编写Web应用程序时，最注重的部分还是“完成本次请求的业务逻辑处理”。

### Web应用程序的应用模式

除了本栏目主要讲解的Django和Flask框架以外，目前较为流行的Web程序框架还有：基于Java的SpringBoot、基于PHP的Lavarel、基于Golang的Gin等。

Web应用程序可分为前后端不分离与前后端分离两种应用模式：

#### 前后端不分离

在前后端不分离的应用模式中，前端页面看到的效果都是由后端控制，由后端渲染页面或重定向，也就是后端需要控制前端的展示，前端与后端的**耦合度很高**。

这种应用模式比较适合纯网页应用，但是当后端对接App时，App可能并不需要后端返回一个HTML网页，而仅仅是数据本身，所以后端原本返回网页的接口不再适用于前端App应用，为了对接App后端还需再开发一套接口。

对应的数据交互如下图：

<img src="https://images.drshw.tech/images/notes/1394466-20180916231510365-285933655.png" alt="img" style="zoom:40%;" />

#### 前后端分离

前后端分离是目前较为流行的开发模式。在这种应用模式中，后端仅返回前端所需的数据，不再渲染HTML页面，不再控制前端的效果。至于前端用户看到什么效果，从后端请求的数据如何加载到前端中，都由前端自己决定，网页有网页的处理方式，App有App的处理方式，但无论哪种前端，所需的数据基本相同，后端仅需开发一套逻辑对外提供数据即可。

在前后端分离的应用模式中 ，前端与后端的**耦合度相对较低**。

在前后端分离的应用模式中，我们通常将后端开发的每个视图都称为一个接口，或者API，前端通过访问接口来对数据进行增删改查。

对应的数据交互如下图：

<img src="https://images.drshw.tech/images/notes/1394466-20180916231716242-1862208927.png" alt="img" style="zoom:40%;" />

在本节介绍的Django框架中，两种应用模式都可以使用。两种模式都会介绍，以前后端分离的模式为主。

## Django 介绍

![img](https://images.drshw.tech/images/notes/django.png)

### 简介

`Django`（**[`dʒæŋɡəʊ]**），是用Python编写的开源Web开发框架，遵循**MVC**设计。

> 劳伦斯出版集团为了开发以新闻内容为主的网站，而开发出来了这个框架，于2005年7月在BSD许可证下发布。这个名称来源于比利时的爵士音乐家DjangoReinhardt，他是一个吉普赛人，主要以演奏吉它为主，还演奏过小提琴等。
>
> 由于Django在近年来的迅速发展，应用越来越广泛，被著名IT开发杂志SDTimes评选为2013SDTimes100，位列"API、库和框架"分类第6位，被认为是该领域的佼佼者。

Django的主要目的是**简便、快速的开发数据库驱动的网站**。它强调**代码复用**，多个组件可以很方便的以**插件**形式服务于整个框架，Django有许多功能强大的第三方插件，你甚至可以很方便的开发出自己的工具包。这使得Django具有很强的**可扩展性**。它还强调快速开发和`DRY`（DoNotRepeatYourself）原则。

### 特点

#### 重量级框架

对比Flask框架，Django原生提供了众多的功能组件，让开发更简便快速。

- 提供项目工程管理的自动化脚本工具
- 数据库**ORM**支持（Object Relational Mapping，对象关系映射）
- 模板
- 表单
- Admin管理站点
- 文件管理
- 认证权限
- session机制
- 缓存

#### MVT模式

有一种程序设计模式叫**MVC**，其核心思想是**分工、解耦**，让不同的代码块之间降低耦合，增强代码的**可扩展性和可移植性**，实现**向后兼容**。

> MVC的全拼为**Model-View-Controller**，最早由TrygveReenskaug在1978年提出，是施乐帕罗奥多研究中心(Xerox PARC)在20世纪80年代为程序语言Smalltalk发明的一种软件设计模式，是为了将传统的输入（input）、处理（processing）、输出（output）任务运用到图形化用户交互模型中而设计的。
>
> 随着标准输入输出设备的出现，开发人员只需要将精力集中在业务逻辑的分析与实现上。后来被推荐为Oracle旗下Sun公司Java EE平台的设计模式，并且受到越来越多的使用ColdFusion和PHP的开发者的欢迎。现在虽然不再使用原来的分工方式，但是这种分工的思想被沿用下来，广泛应用于软件工程中，是一种典型并且应用广泛的软件架构模式。后来，MVC的思想被应用在了Ｗeb开发方面，被称为Ｗeb MVC框架。

##### MVC模式说明

如下图：

<img src="https://images.drshw.tech/images/notes/mvc.png" alt="img" style="zoom:85%;" />

- M全拼为Model，主要封装对数据库层的访问，对数据库中的数据进行增、删、改、查操作；
- V全拼为View，用于封装结果，生成页面展示的HTML内容；
- C全拼为Controller，用于接收请求，处理业务逻辑，与Model和View交互，返回结果。

##### Django 的MVT

如下图：

<img src="https://images.drshw.tech/images/notes/mvt.png" alt="img" style="zoom:85%;" />

- M全拼为Model，与MVC中的M功能相同，负责和数据库交互，进行数据处理；
- V全拼为View，与MVC中的C功能相同，接收请求，进行业务处理，返回应答；
- T全拼为Template，与MVC中的V功能相同，负责封装构造要返回的HTML；
- 差异就在于**黑线黑箭头**标识出来的部分。

### 官方文档和资料

- [官方网站](https://www.djangoproject.com/)
- [Github源码](https://github.com/django/django)
- [英文文档](https://docs.djangoproject.com/en/3.1/)
- [中文文档](https://docs.djangoproject.com/zh-hans/2.2/)

## 搭建Django项目

在使用Flask框架时，项目工程目录的组织与创建是需要我们自己手动创建完成的。

在Django中，项目工程目录可以借助Django提供的命令帮助我们创建。

### 创建项目

首先需要安装Django包（暂时先以2.2.6版本为准）：

```bash
pip install django==2.2.6
```

创建工程的命令为：

```bash
django-admin startproject 工程名称
```

例如：想要在桌面的code目录中创建一个名为`bookmanager`的项目工程，可执行如下命令：

```bash
cd ~/Desktop/Code
django-admin startproject bookmanager
```

执行后，会多出一个新目录名为`bookmanager`，此即为新创建的工程目录。

<img src="https://images.drshw.tech/images/notes/CEE6A4797B6D6A57B69E791F9CC655B9.png" alt="img" style="zoom:60%;" />

### 工程目录说明

查看创建的工程目录，结构如下：

<img src="https://images.drshw.tech/images/notes/BFAAB391EB85D5422003CFE5CE5030B4.png" alt="img" style="zoom:50%;" />

- 与项目同名的目录，此处为`bookmanager`；
- `settings.py`是项目的整体配置文件；
- `urls.py`是项目的URL配置文件；
- `wsgi.py`是项目与WSGI兼容的Web服务器入口；
- `manage.py`是项目管理文件，通过它管理项目。

### 运行开发服务器

在开发阶段，为了能够快速预览到开发的效果，Django提供了一个纯Python编写的轻量级Web服务器，仅在开发阶段使用。

**注意**：若要在服务器端运行，需要在`settings.py`中的`ALLOW_HOSTS`中添加服务器IP地址：

<img src="https://images.drshw.tech/images/notes/06E961EE40E24A1F9831DBC83DD1A8DD.png" alt="img" style="zoom:50%;" />

配置后，运行服务器命令如下：

```py
python manage.py runserver [ip:port]
```

默认`ip`是`127.0.0.1`，默认端口为`8000`，一般执行`python manage.py runserver 0.0.0.0:8000`即可。（若是在生产环境部署，则必须指定`ALLOW_HOSTS`）

启动后可见如下信息：

<img src="https://images.drshw.tech/images/notes/FA5EAE6CAEC01B738C11E430E2F7F994.png" alt="img" style="zoom:50%;" />

在浏览器中输入`对应服务器ip:8000`便可看到效果：

<img src="https://images.drshw.tech/images/notes/image-20221022225938899.png" alt="image-20221022225938899" style="zoom:48%;" />

注意：

- Django默认工作在`debug`调试模式下，如果增加、修改、删除文件，服务器会自动重启；

  在`debug`模式下，若发生运行错误，会在页面中显示错误的位置；

  在生产环境部署时，需要退出`debug`模式，即在`settings.py`中将`DEBUG`字段设置为`False`：

  <img src="https://images.drshw.tech/images/notes/image-20221025231001977.png" alt="image-20221025231001977" style="zoom:33%;" />

- 按`Ctrl + C`停止服务器；

- 为了方便调试，后续代码都在**本地编写**，最后同步到服务器即可。

### Django 子应用

在Web应用中，通常有一些业务功能模块是在不同的项目中都可以**复用**的，故在开发中通常将工程项目拆分为不同的子功能模块，各功能模块间可以保持相对的**独立**。在其他工程项目中需要用到某个特定功能模块时，可以将该模块代码整体复制过去，达到复用。

在Flask框架中也有类似子功能应用模块的概念，即蓝图`Blueprint`。

Django的视图编写是放在**子应用**中的。

#### 创建

在Django中，创建子应用模块目录仍然可以通过命令来操作，即：

```bash
python3 manage.py startapp 子应用名称
```

`manage.py`为上述创建工程时自动生成的管理文件。

例如，在刚才创建的`bookmanager`工程中，想要创建一个用户`book`子应用模块，可执行：

```bash
cd dj2_poj/bookmanager
python3 manage.py startapp book
```

执行后，可以看到工程目录中多出了一个名为`book`的子目录：

<img src="https://images.drshw.tech/images/notes/image-20221023000623398.png" alt="image-20221023000623398" style="zoom:40%;" />

#### 子应用目录说明

查看此时的工程目录，结构如下：

<img src="https://images.drshw.tech/images/notes/image-20221023000714157.png" alt="image-20221023000714157" style="zoom:40%;" />

- `admin.py`：文件跟网站的后台管理站点配置相关。
- `apps.py`：文件用于配置当前子应用的相关信息。
- `migrations`：目录用于存放数据库迁移历史文件。
- `models.py`：文件用户保存数据库模型类。
- `tests.py`：文件用于开发测试用例，编写单元测试。
- `views.py`：文件用于编写Web应用视图。

#### 注册安装子应用

创建出来的子应用目录文件虽然被放到了工程项目目录中，但是Django工程并不能立即直接使用该子应用，需要注册安装后才能使用。

在工程配置文件`settings.py`中，`INSTALLED_APPS`项保存了工程中已经注册安装的子应用，初始工程中的`INSTALLED_APPS`如下：

<img src="https://images.drshw.tech/images/notes/image-20221023001036726.png" alt="image-20221023001036726" style="zoom:35%;" />

前六个已经写好的应用为Django的默认子应用：

+ `admin` 后台管理应用
+ `auth` 用户系统
+ `contenttypes` 上下文管理应用
+ `sessions` 缓存
+ `messages` 信息应用
+ `staticfiles` 静态文件应用

注册安装一个子应用的方法，即是将子应用的配置信息文件`apps.py`中的 **`Config`类添加到`INSTALLED_APPS`列表** 中。

例如，将刚创建的`book`子应用添加到工程中，可在`INSTALLED_APPS`列表中添加`'book.apps.BookConfig'`：

<img src="https://images.drshw.tech/images/notes/image-20221023001455208.png" alt="image-20221023001455208" style="zoom:35%;" />

即可配置完成。

