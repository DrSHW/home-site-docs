---
description: 计算机网络
layout: ../../../layouts/MainLayout.astro
---

## 3.5 介质访问控制

### 3.5.1 两种链路与介质访问控制的概念

传播数据一般会使用以下两种链路：

1. **点对点链路**

   特点：两个相邻结点通过一个链路相连，没有第三者。

   应用：PPP协议，常用于**广域网**。

2. **广播式链路**

   特点：所有主机共享通信介质。

   应用：早期总线以太网、无线局域网，常用于局域网。

   典型拓扑结构：总线型、星型（逻辑总线型）

**介质访问控制** ：采取一定的措施，使得两对节点之间的通信不会发生互相干扰的情况。

<img src="https://images.drshw.tech/images/notes/image-20221231225535946.png" alt="image-20221231225535946" style="zoom: 67%;" />

**信道划分介质访问控制** ：将使用介质的每个设备与来自同一信道上的其他设备的 **通信隔离开** ，把**时域和频域资源**合理地分配给网络上的设备。

### 3.5.2 多路复用技术

**多路复用技术**即将多个信号组合在一条物理信道上进行传输，使得多个计算机或终端设备共享信道资源，提高信道利用率。

![image-20221231225604025](https://images.drshw.tech/images/notes/image-20221231225604025.png)

把一条广播信道，逻辑上分成几条用于两个节点之间通信的互不干扰的子信道，**实际就是把广播信道转变为点到点信道**。

**频分多路复用FDM **：用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。**频分复用的所有用户在同样时间占用不同的带宽（频率带宽Hz）资源。**

**特点** ：充分利用传输介质带宽，系统 **效率较高** ；由于技术比较成熟，实现也比较 **容易。**

类似 **"并行"**

![image-20221231225805144](https://images.drshw.tech/images/notes/image-20221231225805144.png)

**时分多路复用TDM**: 将时间划分为一段段等长的时分复用帧 (TDM帧)。每一个时分复用的用户在每一个TDM帧中占用**固定序号的时隙**，所有用户轮流占用信道。

类似 **"并发"**

![image-20221231225944588](https://images.drshw.tech/images/notes/image-20221231225944588.png)

**改进的时分复用—统计时分复用STDM**：每一个STDM帧中的时隙数小于连接在集中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后集中器按顺序依次扫描**输入缓存**，把缓存中的输入数据放入STDM帧中，一个STDM帧满了就发出。**STDM帧不是固定分配时隙，而是按需动态分配时隙**。

![image-20221231225951204](https://images.drshw.tech/images/notes/image-20221231225951204.png)

大大提高信道利用率

**波分多路复用WDM**：即光的频分多路复用，在一根光纤中传输多种不同波长（频率）的光信号，由于波长（频率）不同，所以各路光信号互不干扰，最后再用波长分解器将各路波长分解出来。

![image-20221231230022234](https://images.drshw.tech/images/notes/image-20221231230022234.png)

**码分多路复用CDM**：

**码分多址（CDMA）** 是码分复用的一种方式，实现步骤如下：

1. 将1个比特分为多个码片/芯片（chip），每一个站点被指定一个唯一的m位的芯片序列。
2. 发送1时站点发送芯片序列，发送0时发送芯片序列反码（通常把**0写成-1**）
3. 避免冲突：多个站点同时发送数据时，要求各站点芯片序列相互**正交**。
4. 合并：各路数据在信道中被**线性相加**。
5. 分离：合并的数据和源站**规格化内积**。

### 3.5.3 随机访问介质访问控制

1. **ALOHA协议**

   纯ALOHA协议思想：不监听信道，不按时间槽发送，随机重发。

   ![image-20221231230344027](https://images.drshw.tech/images/notes/image-20221231230344027.png)

   如果发生冲突，接收方就会检测出差错，然后不予确认，发送方在一定时间内收不到就判断发生冲突。

   解决方式：超时后等一随机时间重传。

2. **时隙ALOHA协议** 

   把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送。解决方式同上。

   ![image-20221231230413784](https://images.drshw.tech/images/notes/image-20221231230413784.png)

   吞吐量比纯ALOHA协议更高，效率更高。（此案中了发送的时间片段）

3. **CSMA（载波监听多路访问）协议**

   CS：载波侦听/监听，每一个站在 **发送数据之前** 以及 **发送数据** 时要检查一下总线上是否有其他计算机在发送数据。

   检测方式：当几个站同时在总线上发送数据时，总线上的信号电压摆动值将增大（互相叠加）。当一个站检测到的信号电压摆动值超过一定门限值时，就认为总线上至少有两个站在发送数据，表明发生了碰撞，即发生了冲突。

   MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。（ **总线型网络** ）

   协议思想：在发送帧之前，监听信道。

   <img src="https://images.drshw.tech/images/notes/image-20221231230502551.png" alt="image-20221231230502551" style="zoom:50%;" />

4. **1-坚持CSMA** 

   坚持指的是对于**监听信道忙**之后的坚持。

   1-坚持CSMA思想：

   + 如果一个主机要发送消息，那么它先监听信道：

   + **空闲则直接传输，不必等待；**
   + **忙则一直监听，直到空闲马上传输；**
   + 如果有冲突（一段时间内未收到肯定回复），则等待一个随机长的时间再监听，重复上述过程。

   优点：只要媒体空闲，站点就马上发送，避免了媒体利用率的损失。

   缺点：假如有两个或两个以上的站点有数据要发送，冲突就不可避免。

5. **非坚持CSMA**

   非坚持指的是对于**监听信道忙**之后就不继续监听。

   p-坚持CSMA思想：

   + 如果一个主机要发送消息，那么它先监听信道。

   + **空闲则直接传输，不必等待；**
   + **忙则等待一个随机的时间之后再继续监听；**

   优点：采用随机的重发延迟时间可以减少冲突发生的可能性。

   缺点：可能存在大家都在延迟等待过程中，使得媒体仍可能处于空闲状态，媒体使用率降低。

6. **p-坚持CSMA** ：

   p-坚持指的是对于监听信道空闲的处理。

   p-坚持CSMA思想：

   + 如果一个主机要发送消息，那么它先监听信道。

   + **空闲则以`p`概率直接传输，不必等待；概率`1-p`等待到下一个时间槽再传输。**
   + **忙则等待一个随机时间之后在进行监听。**

   优点：既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间的这种方案。

   缺点：发生冲突后还是要坚持把数据帧发送完，造成了浪费。

对比：

![image-20221231230829639](https://images.drshw.tech/images/notes/image-20221231230829639.png)

7. **CSMA/CD协议**（载波监听多点接入/碰撞检测）

   CD：碰撞检测，"边发送边监听"，适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据。（ **半双工网络** ）

   **传播时延对载波监听的影响** ：

   ![image-20221231230851342](https://images.drshw.tech/images/notes/image-20221231230851342.png)

   确定重传时机——截断二进制指数规避算法

   1. 确定基本退避（推迟）时间为争用期`2τ`。
   1. 定义参数`k`，它等于重 **传次数，** 但`k`不超过10，即`k = min[重传次数, 10]`。当重传次数不超过10时，`k`等于重传次数；当重传次数大于10时，`k`就不再增大而一直等于10。
   1. 从离散的整数集合<img src="https://images.drshw.tech/images/notes/image-20221231231056945.png" alt="image-20221231231056945" style="zoom:50%;" />中随机取出一个数`r`，重传所需要退避的时间就是 **`r`倍的基本退避时间**，即`2rτ`。
   1. 当重传达16次仍不能成功时，说明网络太拥挤，认为此帧永远无法正确发出，抛弃此帧并向高层报告出错。

   

   例子：

   ![image-20221231231139360](https://images.drshw.tech/images/notes/image-20221231231139360.png)

   若连续多次发生冲突，就标明可能有较多的站参与争用信道。使用此算法可使重传需要推迟的平均时间随重传次数的增大而增大，因而减小发生碰撞的概率，有利于整个系统的稳定。

   例题：

   ![image-20221231231210211](https://images.drshw.tech/images/notes/image-20221231231210211.png)

   **最小帧长** ：帧的传输时延至少要两倍于信号在总线的传播时延。

   <img src="https://images.drshw.tech/images/notes/image-20221231231236696.png" alt="image-20221231231236696" style="zoom:50%;" />

   以太网规定最短帧长为64B，凡是长度小于64B的都是由冲突而异常终止的无效帧。

   ![image-20221231231309152](https://images.drshw.tech/images/notes/image-20221231231309152.png)

8. **CSMA/CA协议**（载波监听多点接入/碰撞避免）

   无线局域网存在的缺陷：

   1. 无法做到360度全面检测碰撞 
   2.  隐蔽站（当A和C都检测不到信号，认为信道空闲时，同时向终端B发送数据帧，就会导致冲突）

   **CSMA/CA工作原理** ：

   1. 发送数据前，先检测信道是否空闲。
   2. 空闲则发出RTS（request to send），RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息：信道忙则等待。
   3. 接收端收到RTX后，将响应CTX（clear to send）。
   4. 发送端收到CTX后，开始发送数据帧（同时预约信道：发送方告知其他站点自己要传多久数据）
   5. 接收端收到数据帧后，将用CRC来检验数据是否正确，正确则响应ACK帧。
   6. 发送方收到ACK就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止（采用 **二进制数退避算法** 来确定随机的推迟时间）

**CSMA/CD与CSMA/CA的异同点**：

+ **相同点：**

  CSMA/CD机制都从属于CSMA的思路，其核心是 **先听再说** 。换言之，两个在接入信道之前都需要进行监听。当发现信道空闲时，才能进行接入。

+ **不同点：**

  1. **传播介质不同** ：

     CSMA/CD用于总线式以太网【有线】，而CSMA/CA用于无线局域网【无线】。

  2. **载波检测方式不同** ：

     因 **传输介质不同** ，CSMA/CD与CSMA/CA的 **检测方式也不同** 。

     + CSMA/CD通过电缆中电压的变化来检测，当数据发生碰撞时，电缆中的电压就会随着发生变化；
     + CSMA/CA采用能量检测（ED）、载波检测（CS）和能量载波检测三种检测信道空闲的方式。

  3. **CSMA/CD检测冲突，CSMA/CA避免冲突**，二者出现冲突后都会进行有上限的重传。


### 3.5.4 介质的访问控制

1. **信道划分介质访问控制（MAC）协议** ：

   基于 **多路复用** 技术划分资源。

   网络负载重：共享信道效率高，且公平

   网络负载轻：共享信道效率低

2. 随机访问MAC协议：冲突

   用户根据意愿 **随机** 发送信息，发送信息时可独占信道带宽。

   网络负载重：产生冲突开销

   网络负载轻：共享信道效率高，单个节点可利用信道全部带宽。

3. 轮询访问MAC协议/轮流协议/轮转访问MAC协议：

   即要 **不产生冲突** ，又要发送时 **占全部带宽** 。

   **1）轮询协议** ：主结点轮流"邀请"从属结点发送数据。

   问题：

   1. 轮询开销 
   1. 等待延迟
   1. 单点故障

   **2）令牌传递协议** ：

   令牌：一个特殊格式的MAC控制帧，不含任何信息。

   控制信道的使用，确保同一时刻只有一个结点独占信道。

   **令牌环网无碰撞**

   每个结点都可以在一定时间内（令牌持有时间）获得发送数据的权利，并不是无限制地持有令牌。

   问题：

   1. 令牌开销
   1. 等待延迟
   1. 单点故障

   应用于令牌环网（物理星型拓扑，逻辑环形拓扑）。

   采用令牌传送方式的网络常用于 **负载较重、通信量较大** 的网络中。

   ![image-20221231231903270](https://images.drshw.tech/images/notes/image-20221231231903270.png)
